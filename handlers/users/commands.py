import logging
import sqlite3

import aiohttp
from aiogram import types
from aiogram.dispatcher.filters.builtin import Command, CommandHelp
from aiogram.dispatcher.filters.builtin import CommandStart

from keyboards.default import stats_menu, options_menu
from keyboards.inline import get_started_markup
from loader import dp, db


@dp.message_handler(CommandStart())
async def bot_start(message: types.Message):
    """
    –§—É–Ω–∫—Ü–∏—è - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
    """
    user_id = message.chat.id
    try:
        db.add_user(user_id)
    except sqlite3.IntegrityError as err:
        logging.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å id: {user_id} —É–∂–µ –µ—Å—Ç—å –≤ –±–∞–∑–µ")
    photo_url = "https://www.boredpanda.com/blog/wp-content/uploads/" \
                "2020/03/Iranian-artist-makes-impactful-cartoons-to-reflect-on-the-coronavirus-5e81909a523c8__880.jpg"
    async with aiohttp.ClientSession() as session:
        async with session.get(photo_url, verify_ssl=False) as response:
            if response.status == 200:
                exclamation_mark = f"<a href='{photo_url}'>!</a>"
            else:
                exclamation_mark = "!"

    await message.answer(f"<b>–ü—Ä–∏–≤–µ—Ç{exclamation_mark}</b> –Ø ‚Äî –±–æ—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ \n"
                         f"—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ <u>–∫–æ—Ä–æ–Ω–∞–≤–∏—Ä—É—Å—É</u> ü¶†\n\n"
                         f"–° –ø–æ–º–æ—â—å—é –º–µ–Ω—è, —Ç—ã —Å–º–æ–∂–µ—à—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —É–∑–Ω–∞—Ç—å –ª—é–±—É—é, \n"
                         f"–∏–Ω—Ç–µ—Ä–µ—Å—É—é—â—É—é —Ç–µ–±—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –±–æ–ª–µ–∑–Ω–∏. \n\n"
                         f"<b><i>–ß—Ç–æ —è —É–º–µ—é?</i></b>\n"
                         f"    - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–∏—Ä–æ–≤—É—é –∏ \n"
                         f"      –≤—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É üåç\n\n"
                         f"    - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ –∑–∞ \n"
                         f"      –≤—Å—ë –≤—Ä–µ–º—è —Ä–∞–∑–≤–∏—Ç–∏—è –≤–∏—Ä—É—Å–∞, \n"
                         f"      —Ç–∞–∫ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∑–∞ \n"
                         f"      —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å üïë\n\n"
                         f"    - –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–µ–≥–æ \n"
                         f"      —Ä–µ–≥–∏–æ–Ω–∞, —è –º–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –≤–∞–º \n"
                         f"      —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–º–µ–Ω–Ω–æ –ø–æ –≤–∞—à–µ–º—É\n"
                         f"      –º–µ—Å—Ç—É –∂–∏—Ç–µ–ª—å—Å—Ç–≤–∞ üì™\n\n"
                         f"<b>–ö–æ–º–∞–Ω–¥—ã:</b>\n"
                         f"    - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: /stats\n"
                         f"    - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: /options\n"
                         f"    - –ø–æ–º–æ—â—å: /help\n",
                         reply_markup=get_started_markup)


@dp.message_handler(Command("stats"))
async def show_menu(message: types.Message):
    """
    –§—É–Ω–∫—Ü–∏—è - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /stats
    """
    await message.answer("/stats", reply_markup=stats_menu, disable_notification=True)


@dp.message_handler(Command("options"))
async def change_region(message: types.Message):
    """
    –§—É–Ω–∫—Ü–∏—è - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /options
    """
    await message.answer("/options", reply_markup=options_menu, disable_notification=True)


@dp.message_handler(CommandHelp())
async def change_region(message: types.Message):
    """
    –§—É–Ω–∫—Ü–∏—è - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help
    """
    await message.answer('<b>–°–ø—Ä–∞–≤–∫–∞</b>\n\n'
                         ''
                         '–ö–Ω–æ–ø–∫–∞ "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç \n'
                         '–º–µ–Ω—é –ø–æ–∫–∞–∑–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.\n\n'
                         ''
                         '–í—ã–±–µ—Ä–µ—Ç–µ –∂–µ–ª–∞–µ–º—É—é –∑–æ–Ω—É –æ—Ö–≤–∞—Ç–∞ –∑–µ–º–Ω–æ–≥–æ —à–∞—Ä–∞:\n'
                         '   1) –ú–∏—Ä–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ \n'
                         '         - –¥–∞–Ω–Ω—ã–µ —Å–æ –≤—Å–µ–≥–æ –º–∏—Ä–∞\n'
                         '   2) –í—Å–µ—Ä–æ—Å—Å–∏–π—Å–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ \n'
                         '         - –¥–∞–Ω–Ω—ã–µ —Å–æ –≤—Å–µ–π –†–æ—Å—Å–∏–∏\n'
                         '   3) –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ \n'
                         '         - –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ \n'
                         '            –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–≥–∏–æ–Ω–∞\n'
                         '   4) –ü—Ä–æ—á–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, \n'
                         '        –ø–æ –Ω–∞–∂–∞—Ç–∏—é –∫–Ω–æ–ø–∫–∏ "–ï—â—ë"\n'
                         '---------------------------------------\n'
                         '<i>–ï—Å–ª–∏ –≤—ã –µ—â—ë –Ω–µ –≤—ã–±—Ä–∞–ª–∏ –≤–∞—à —Ä–µ–≥–∏–æ–Ω, \n'
                         '—Ç–æ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, \n'
                         '–≤—ã —É–≤–∏–¥–∏—Ç–µ –æ–∫–Ω–æ, \n'
                         '–≤ –∫–æ—Ç–æ—Ä–æ–º —Å–º–æ–∂–µ—Ç–µ –µ–≥–æ –≤—ã–±—Ä–∞—Ç—å. \n'
                         '(–∏–∑–º–µ–Ω–∏—Ç—å —Ä–µ–≥–∏–æ–Ω –±—É–¥–µ—Ç –º–æ–∂–Ω–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç)</i>\n'
                         '---------------------------------------\n'
                         '–ö–Ω–æ–ø–∫–∞ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏" –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç \n'
                         '–º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫. \n\n'
                         ''
                         '–í—ã –º–æ–∂–µ—Ç–µ:\n'
                         '    - –∏–∑–º–µ–Ω–∏—Ç—å –≤–∞—à —Ä–µ–≥–∏–æ–Ω\n'
                         '    - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–∏–ø—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤, \n'
                         '       –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å\n'
                         '---------------------------------------\n'
                         '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤. \n\n'
                         ''
                         '–í–∞–º –¥–æ—Å—Ç—É–ø–µ–Ω:\n'
                         '    - –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–µ–∂—É—Ç–∫–∞ \n'
                         '       –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:\n'
                         '		           –∞) –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü\n'
                         '             –±) –ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–¥\n'
                         '             –≤) –ó–∞ –≤—Å—ë –≤—Ä–µ–º—è\n\n'
                         ''
                         '    - –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö \n'
                         '       –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ –¥–∞–Ω–Ω—ã—Ö :\n'
                         '		           a) –û–±—â–µ–µ —á–∏—Å–ª–æ —Å–ª—É—á–∞–µ–≤ \n'
                         '                  –Ω–∞ –º–æ–º–µ–Ω—Ç –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è \n'
                         '                  ("–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è" \n'
                         '                  —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)\n\n'
                         ''

                         '             –±) –ü—Ä–∏—Ä–æ—Å—Ç —á–∏—Å–ª–∞ —Å–ª—É—á–∞–µ–≤ \n'
                         '                  –∑–∞ –∫–∞–∂–¥—ã–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π \n'
                         '                  –¥–µ–Ω—å\n\n'
                         '---------------------------------------',
                         reply_markup=get_started_markup)
